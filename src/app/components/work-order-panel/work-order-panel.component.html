<!-- Panel wrapper (always in DOM, shown/hidden via class) -->
<div class="panel-wrapper" [class.open]="isOpen()">
  <!-- Overlay (clickable to close) -->
  <div class="overlay" (click)="close()"></div>

  <!-- Side Panel -->
  <div class="work-order-panel" [class.open]="isOpen()">
    <!-- Header -->
    <div class="panel-header">
      <div class="header-content">
        <div class="header-left">
          <div class="panel-title">Work Order Details</div>
          <div class="panel-subtitle">Specify the dates, name and status for this order</div>
        </div>
        <div class="header-buttons">
          <button class="btn btn-cancel" type="button" (click)="close()">Cancel</button>
          <button class="btn btn-create" type="button" (click)="onSubmit()">
            {{ isEditMode() ? 'Save' : 'Create' }}
          </button>
        </div>
      </div>
    </div>

    <!-- Panel body -->
    <div class="panel-body">
      <form class="panel-form" [formGroup]="form" (ngSubmit)="onSubmit()">

        <!-- Work Order Name -->
        <div class="form-field">
          <label class="field-label">Work Order Name</label>
          <input
            type="text"
            class="text-input"
            [class.input-error]="nameControl.invalid && nameControl.touched"
            placeholder="Enter work order name"
            formControlName="name"
          />
          @if (nameControl.invalid && nameControl.touched) {
            <span class="error-message">Work order name is required.</span>
          }
        </div>

        <!-- Status -->
        <div class="form-field">
          <label class="field-label">Status</label>
          <ng-select
            class="status-select"
            [class.select-error]="statusControl.invalid && statusControl.touched"
            formControlName="status"
            [items]="statusOptions"
            bindValue="value"
            bindLabel="label"
            placeholder="Select status"
            [clearable]="false"
            [searchable]="false"
          >
            <ng-template ng-option-tmp let-item="item">
              {{ item.label }}
            </ng-template>
            <ng-template ng-label-tmp let-item="item">
              <span class="status-pill" [ngClass]="'pill-' + item.value">{{ item.label }}</span>
            </ng-template>
          </ng-select>
          @if (statusControl.invalid && statusControl.touched) {
            <span class="error-message">Please select a status.</span>
          }
        </div>

        <!-- Overlap error banner -->
        @if (form.errors?.['workCenterOverlap'] && (startDateControl.touched || endDateControl.touched)) {
          <div class="form-error-banner">
            This Work Center is already scheduled during the selected dates.
          </div>
        }

        <!-- Start Date & Time row -->
        <div class="form-row">
          <div class="form-field">
            <label class="field-label">Start Date</label>
            <div class="date-input-wrapper">
              <input
                type="date"
                class="date-input"
                [class.input-error]="startDateControl.invalid && startDateControl.touched"
                formControlName="startDate"
              />
            </div>
            @if (startDateControl.invalid && startDateControl.touched) {
              <span class="error-message">Start date is required.</span>
            }
          </div>
          <div class="form-field">
            <label class="field-label">Start Time</label>
            <div class="date-input-wrapper">
              <input
                type="time"
                class="date-input"
                [class.input-error]="startTimeControl.invalid && startTimeControl.touched"
                formControlName="startTime"
              />
            </div>
            @if (startTimeControl.invalid && startTimeControl.touched) {
              <span class="error-message">Start time is required.</span>
            }
          </div>
        </div>

        <!-- End Date & Time row -->
        <div class="form-row">
          <div class="form-field">
            <label class="field-label">End Date</label>
            <div class="date-input-wrapper">
              <input
                type="date"
                class="date-input"
                [class.input-error]="(endDateControl.invalid && endDateControl.touched) || (form.errors?.['endDateBeforeStartDate'] && endDateControl.touched)"
                formControlName="endDate"
              />
            </div>
            @if (endDateControl.invalid && endDateControl.touched) {
              <span class="error-message">End date is required.</span>
            }
          </div>
          <div class="form-field">
            <label class="field-label">End Time</label>
            <div class="date-input-wrapper">
              <input
                type="time"
                class="date-input"
                [class.input-error]="(endTimeControl.invalid && endTimeControl.touched) || (form.errors?.['endDateBeforeStartDate'] && endTimeControl.touched)"
                formControlName="endTime"
              />
            </div>
            @if (form.errors?.['endDateBeforeStartDate'] && (endDateControl.touched || endTimeControl.touched)) {
              <span class="error-message">End must be later than start.</span>
            }
          </div>
        </div>

      </form>
    </div>
  </div>
</div>
